use w5base;
CREATE TABLE wfattach (
  wfattachid bigint(20) NOT NULL default '0',
  wfdataid bigint(20) default NULL,
  wfheadid bigint(20) default NULL,
  data blob,
  createuser bigint(20) NOT NULL default '0',
  createdate datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (wfattachid),
  KEY createdate (createdate),
  KEY wfheadid (wfheadid),
  KEY wfdataid (wfdataid)
);
CREATE TABLE wfkey (
  id bigint(20) NOT NULL,
  name varchar(30) NOT NULL default '',
  fval varchar(128) NOT NULL default '',
     wfstate    tinyint(3) default NULL,
     opendate   datetime   default NULL,
     closedate  datetime   default NULL,
     eventstart datetime   default NULL,
     eventend   datetime   default NULL,
     wfclass varchar(30)   default NULL,
  createdate datetime NOT NULL default '0000-00-00 00:00:00',
  editor varchar(100) default NULL,
  realeditor varchar(100) default NULL,
  UNIQUE KEY nameval (fval,name,id),
  KEY name (name,id), key id(id),
  KEY search1 (fval,name,eventstart,wfclass),
  KEY search2 (fval,name,eventend,wfclass),
  KEY search3 (fval,name,opendate,wfclass),
  KEY search4 (fval,name,closedate,wfclass),
  KEY search5 (fval,name,wfstate,wfclass)
);
CREATE TABLE wfaction (
  wfactionid bigint(20) NOT NULL default '0',
  wfheadid bigint(20) NOT NULL default '0',
  name        varchar(30) NOT NULL,
  translation varchar(40) NOT NULL,
  actionref   longtext NOT NULL,
  additional  longtext NOT NULL,
  comments    longtext default NULL,effort int(14),
  createuser bigint(20) NOT NULL default '0',
  modifyuser bigint(20) NOT NULL default '0',
  createdate datetime NOT NULL default '0000-00-00 00:00:00',
  modifydate datetime NOT NULL default '0000-00-00 00:00:00',
  srcsys varchar(40) default NULL,
  srcid varchar(20) default NULL,
  srcload datetime default NULL,
  editor varchar(100) NOT NULL default '',
  realeditor varchar(100) NOT NULL default '',
  PRIMARY KEY  (wfactionid),
  KEY action (wfheadid,name),key(createuser),
  KEY modifydate (modifydate),
  KEY wfheadid (wfheadid)
);
CREATE TABLE wfhead (
  wfheadid bigint(20) NOT NULL default '0',
  shortdescription varchar(128) NOT NULL default '',
  description text NOT NULL,
  wfstate tinyint(3) unsigned default NULL,prio int(1) default '5',
  wfclass varchar(30) NOT NULL default '',
  wfstep varchar(40) NOT NULL default '',
  fwdtarget varchar(20) default NULL,
  fwdtargetid bigint(20) default NULL,
  fwddebtarget varchar(20) default NULL,
  fwddebtargetid bigint(20) default NULL,
  opendate datetime NOT NULL default '0000-00-00 00:00:00',
  closedate datetime default NULL,
  modifydate datetime NOT NULL default '0000-00-00 00:00:00',
  openuser bigint(20) default NULL,
  openusername varchar(255) default NULL,
  closeuser bigint(20) default NULL,
  modifyuser bigint(20) default NULL,
  eventstart datetime default NULL,
  eventend datetime default NULL,
  headref longtext NOT NULL,
  initiallang   varchar(5) NOT NULL,
  initialsite   varchar(128) NOT NULL,
  initialconfig varchar(20) NOT NULL,
  initialclient varchar(20) NOT NULL,
  srcsys varchar(100) default NULL,
  srcid varchar(20) default NULL,
  srcload datetime default NULL,
  additional longtext default NULL,
  editor varchar(100) NOT NULL default '',
  realeditor varchar(100) NOT NULL default '',
  PRIMARY KEY  (wfheadid),
  KEY openuser (openuser,wfstate),KEY modifyuser (modifyuser,wfstate),
  unique srcsys(srcsys,srcid),key srcid(srcid),
  key srcload(srcsys,srcload),key modifydate(modifydate),
  key fwd(fwdtarget,fwdtargetid,wfstate),
  key wfclass(wfclass,wfstep),
  key wfstep(wfstep)
);
CREATE TABLE joblog (
  id bigint(20) NOT NULL default '0',
  method    varchar(128) NOT NULL default '',
  event     varchar(40)  NOT NULL default '',
  exitcode  int(20)      default NULL,srcsys varchar(10) default 'w5base',
  pid       int(20)      default NULL,srcid varchar(20) default NULL,
  exitstate varchar(20)  default NULL,srcload datetime default NULL,
  createdate datetime NOT NULL default '0000-00-00 00:00:00',
  modifydate datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (id),UNIQUE KEY `srcsys` (srcsys,srcid),
  KEY method (method),key srcload(srcload),
  KEY event  (event,method),key(pid),
  KEY createdate  (createdate),
  KEY modifydate  (modifydate,method,exitcode)
);
alter table wfaction add privatestate int(2) default '0';
CREATE TABLE wfrelation (
  wfrelationid bigint(20) NOT NULL default '0',
  srcwfid bigint(20) NOT NULL default '0',
  dstwfid bigint(20) NOT NULL default '0',
  name        varchar(30) NOT NULL,
  translation varchar(40) NOT NULL,
  additional  longtext NOT NULL,
  comments    longtext default NULL,
  createuser bigint(20) NOT NULL default '0',
  modifyuser bigint(20) NOT NULL default '0',
  createdate datetime NOT NULL default '0000-00-00 00:00:00',
  modifydate datetime NOT NULL default '0000-00-00 00:00:00',
  srcsys varchar(40) default NULL,
  srcid varchar(20) default NULL,
  srcload datetime default NULL,
  editor varchar(100) NOT NULL default '',
  realeditor varchar(100) NOT NULL default '',
  PRIMARY KEY  (wfrelationid),
  key srcid (srcwfid),key dstid (dstwfid)
);
CREATE TABLE wfworkspace (
  id          bigint(20) NOT NULL default '0',
  wfheadid    bigint(20) default NULL,
  fwdtarget   varchar(20) default NULL,
  fwdtargetid bigint(20) default NULL,
  additional  longtext NOT NULL,
  createuser  bigint(20) NOT NULL default '0',
  createdate  datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY (id),key fwd(fwdtarget,fwdtargetid)
);
