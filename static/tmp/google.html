<html>
<head>
<script type="text/javascript" src="http://getfirebug.com/firebug-lite.js"></script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript" src="jquery.js"></script>
<script>
//
// Google Contacts API at 
// http://code.google.com/intl/de/apis/gdata/jsdoc/2.2/index.html

var contactsObj;

// Error handler
var handleError = function(error) {
  alert(error);
}


function getMyContacts() {
  var contactsFeedUri = 'https://www.google.com/m8/feeds/contacts/default/full';
  var query = new google.gdata.contacts.ContactQuery(contactsFeedUri);
  
  // Set the maximum of the result set to be 5
  query.setMaxResults(5);
  
  contactsObj.getContactFeed(query, handleContactsFeed, handleError);
}

var handleContactsFeed = function(result) {
  var entries = result.feed.entry;
  var d="";
  for (var i = 0; i < entries.length; i++) {
    var contactEntry = entries[i];
    var emailAddresses = contactEntry.getEmailAddresses();

    var n = contactEntry.getName();
    var disp=n.getFamilyName().getValue();

    var p = contactEntry.getPhoneNumbers();

    var phone;
    if (p && p[0]){
       phone=p[0].getLabel()+"="+p[0].getValue();
    }
    
    for (var j = 0; j < emailAddresses.length; j++) {
      var emailAddress = emailAddresses[j].getAddress();
      d+=disp+' email = ' + emailAddress+";"+phone+"<br>";
    }    
  }
  $('#out').html(d);
}

function setupContactsService() {
  contactsObj=new google.gdata.contacts.ContactsService('W5Base-Contacts-1.0');
  //contactsObj=new google.gdata.contacts.ContactsService('exampleCo-exampleApp-1.0');
}

function logMeIn() {
  var scope = 'https://www.google.com/m8/feeds';
  var token = google.accounts.user.login(scope);
}

function initFunc() {
  logMeIn();
  setupContactsService();
}
google.load("gdata", "2");
google.setOnLoadCallback(initFunc);

//$(document).ready(function(){
//   alert("ok");
//
//});
</script>
</head>
<body><form>
<img src="empty.gif">
<input type=text id=search>
<input type=button onclick='getMyContacts();' value="search">
<div id=out>
</div>
</form></body>
</html>
